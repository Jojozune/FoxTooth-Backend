<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FoxTooth Backend - System Overview & Architecture</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        body {
            font-family: 'Source Sans Pro', sans-serif;
            color: #495159;
            background: linear-gradient(135deg, #f7f9f9 0%, #ffffff 100%);
            line-height: 1.6;
        }

        header {
            background: linear-gradient(135deg, #000000 0%, #495159 100%);
            color: #f7f9f9;
            padding: 50px 20px;
            text-align: center;
            border-bottom: 4px solid #db7c26;
        }

        header h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 10px;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
            animation: fadeInUp 0.8s ease-out;
        }

        header p {
            font-size: 1rem;
            opacity: 0.9;
        }

        .accent {
            color: #db7c26;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .nav-button {
            display: inline-block;
            background: #495159;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 600;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .nav-button:hover {
            background: #000000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        section {
            margin: 50px 0;
        }

        h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            color: #000000;
            margin-bottom: 15px;
            border-bottom: 3px solid #db7c26;
            padding-bottom: 10px;
        }

        h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.4rem;
            font-weight: 600;
            color: #000000;
            margin: 30px 0 15px 0;
        }

        h4 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: #000000;
            margin: 20px 0 10px 0;
        }

        .tech-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .tech-card {
            background: white;
            border-radius: 8px;
            padding: 25px;
            border-left: 5px solid #db7c26;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }

        .tech-card:hover {
            box-shadow: 0 8px 24px rgba(219, 124, 38, 0.15);
            transform: translateY(-3px);
        }

        .tech-card h4 {
            margin-top: 0;
            color: #db7c26;
        }

        .tech-card ul {
            list-style: none;
            margin: 15px 0 0 0;
            padding: 0;
        }

        .tech-card li {
            padding: 6px 0;
            color: #495159;
            font-size: 0.9rem;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .feature-box {
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-top: 4px solid #db7c26;
        }

        .feature-box h4 {
            margin-top: 0;
        }

        .note {
            background: #fffbea;
            border-left: 4px solid #fbc02d;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }

        .note strong {
            color: #f57f17;
        }

        .tip {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }

        .tip strong {
            color: #2e7d32;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: #f5f5f5;
            font-weight: 700;
            color: #000000;
        }

        tr:hover {
            background: #fafafa;
        }

        ul, ol {
            margin-left: 20px;
            margin-top: 10px;
        }

        li {
            margin: 8px 0;
        }

        code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 0.9rem;
        }

        footer {
            background: #000000;
            color: #f7f9f9;
            text-align: center;
            padding: 30px 20px;
            border-top: 4px solid #db7c26;
            margin-top: 60px;
        }

        footer a {
            color: #db7c26;
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8rem;
            }
            h2 {
                font-size: 1.4rem;
            }
            .tech-grid {
                grid-template-columns: 1fr;
            }
            .feature-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>FoxTooth <span class="accent">System Overview</span></h1>
        <p>Architecture, Technology Stack, and Design Principles</p>
    </header>

    <div class="container">
        <a href="docs-hub.html" class="nav-button">‚Üê Back to Documentation Hub</a>

        <section>
            <h2>System Architecture</h2>
            <p>FoxTooth Backend is a modern, scalable Node.js application designed for multiplayer game servers. It handles authentication, player management, real-time multiplayer coordination, and persistent data storage.</p>

            <div class="note">
                <strong>üìä Production Status:</strong> Fully tested, documented, and ready for deployment. Used in production environments.
            </div>
        </section>

        <section>
            <h2>Technology Stack</h2>

            <div class="tech-grid">
                <div class="tech-card">
                    <h4>üöÄ Runtime</h4>
                    <ul>
                        <li>Node.js 16+</li>
                        <li>V8 JavaScript Engine</li>
                        <li>Native async/await</li>
                        <li>EventEmitter architecture</li>
                    </ul>
                </div>

                <div class="tech-card">
                    <h4>üîß Framework</h4>
                    <ul>
                        <li>Express.js 4.18+</li>
                        <li>Middleware ecosystem</li>
                        <li>Request routing</li>
                        <li>Error handling</li>
                    </ul>
                </div>

                <div class="tech-card">
                    <h4>‚ö° Real-Time</h4>
                    <ul>
                        <li>Socket.IO 4.8+</li>
                        <li>WebSocket support</li>
                        <li>Binary protocol</li>
                        <li>Fallback polling</li>
                    </ul>
                </div>

                <div class="tech-card">
                    <h4>üóÑÔ∏è Database</h4>
                    <ul>
                        <li>MySQL 5.7+</li>
                        <li>InnoDB engine</li>
                        <li>Connection pooling</li>
                        <li>Query optimization</li>
                    </ul>
                </div>

                <div class="tech-card">
                    <h4>üîê Security</h4>
                    <ul>
                        <li>JWT tokens</li>
                        <li>bcryptjs hashing</li>
                        <li>CORS middleware</li>
                        <li>Rate limiting</li>
                    </ul>
                </div>

                <div class="tech-card">
                    <h4>‚úîÔ∏è Validation</h4>
                    <ul>
                        <li>express-validator</li>
                        <li>Input sanitization</li>
                        <li>Type checking</li>
                        <li>Custom validators</li>
                    </ul>
                </div>
            </div>
        </section>

        <section>
            <h2>Core Components</h2>

            <h3>Authentication System</h3>
            <div class="feature-box">
                <h4>JWT-Based Authentication</h4>
                <p>Stateless authentication using signed JWT tokens. Players receive access tokens (2-hour expiry) and refresh tokens (7-day expiry) on successful login.</p>
                <ul>
                    <li><strong>Access Token:</strong> Short-lived, used for API calls</li>
                    <li><strong>Refresh Token:</strong> Long-lived, used to obtain new access tokens</li>
                    <li><strong>Remember Token:</strong> Optional, enables passwordless login</li>
                </ul>
            </div>

            <h3>Player Management</h3>
            <div class="feature-box">
                <h4>Online Status & Heartbeats</h4>
                <p>Players maintain online status through periodic heartbeat messages. The server tracks last heartbeat and marks players offline after 120 seconds of inactivity.</p>
                <ul>
                    <li>Heartbeat interval: 30 seconds (client-side)</li>
                    <li>Timeout threshold: 120 seconds</li>
                    <li>Status updates: Real-time via WebSocket</li>
                </ul>
            </div>

            <h3>Friends System</h3>
            <div class="feature-box">
                <h4>Bi-Directional Friendships</h4>
                <p>Players can send friend requests, manage pending requests, and maintain friend lists. Friendships are stored with status (pending, accepted, blocked).</p>
                <ul>
                    <li>Friend requests with notifications</li>
                    <li>Accept/reject mechanism</li>
                    <li>Block/unblock functionality</li>
                    <li>Online status for friends</li>
                </ul>
            </div>

            <h3>Game Invites & Sessions</h3>
            <div class="feature-box">
                <h4>Multiplayer Session Management</h4>
                <p>Players can create game sessions, send time-limited invites to friends, and track session participants.</p>
                <ul>
                    <li>Session codes for easy joining</li>
                    <li>Invite expiration (120 seconds)</li>
                    <li>Invite status tracking</li>
                    <li>Player join notifications</li>
                </ul>
            </div>
        </section>

        <section>
            <h2>API Architecture</h2>

            <table>
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Endpoints</th>
                        <th>Primary Use</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Account Management</strong></td>
                        <td>3 endpoints</td>
                        <td>Registration, login, account recovery</td>
                    </tr>
                    <tr>
                        <td><strong>Authentication</strong></td>
                        <td>4 endpoints</td>
                        <td>Token validation, refresh, logout, heartbeat</td>
                    </tr>
                    <tr>
                        <td><strong>Player Management</strong></td>
                        <td>5 endpoints</td>
                        <td>Player lookup, profile, online status, disconnect</td>
                    </tr>
                    <tr>
                        <td><strong>Friends System</strong></td>
                        <td>4 endpoints</td>
                        <td>Friend requests, friend list, removal</td>
                    </tr>
                    <tr>
                        <td><strong>Game Invites</strong></td>
                        <td>3 endpoints</td>
                        <td>Send invites, check pending, respond to invites</td>
                    </tr>
                    <tr>
                        <td><strong>Game Sessions</strong></td>
                        <td>2 endpoints</td>
                        <td>Create session, join session</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section>
            <h2>Data Flow</h2>

            <h3>Authentication Flow</h3>
            <ol>
                <li>Client sends login request with credentials</li>
                <li>Server validates password against bcrypt hash</li>
                <li>Server generates JWT access token (2 hours)</li>
                <li>Server generates refresh token (7 days)</li>
                <li>Client stores tokens securely (Keychain/encrypted storage)</li>
                <li>Client sends Authorization header with every request</li>
            </ol>

            <h3>Game Invite Flow</h3>
            <ol>
                <li>Player 1 creates a game session (gets session code)</li>
                <li>Player 1 sends invite to Player 2 with session code</li>
                <li>Server checks Player 2 is online</li>
                <li>Player 2 receives invite notification (WebSocket)</li>
                <li>Player 2 accepts invite, joining the session</li>
                <li>Server notifies Player 1 of acceptance</li>
            </ol>

            <h3>Heartbeat System</h3>
            <ol>
                <li>Client sends heartbeat every 30 seconds</li>
                <li>Server updates <code>last_heartbeat</code> timestamp</li>
                <li>If no heartbeat for 120s, player marked offline</li>
                <li>Offline status broadcast to friends (WebSocket)</li>
                <li>On reconnect, friend status updates automatically</li>
            </ol>
        </section>

        <section>
            <h2>Deployment Architecture</h2>

            <h3>Single-Server Deployment</h3>
            <p>Suitable for small to medium games (up to 10,000 concurrent players):</p>
            <ul>
                <li>Single Node.js process on your server</li>
                <li>MySQL database on same server or separate DB server</li>
                <li>Direct client connections</li>
                <li>No load balancing needed</li>
            </ul>

            <h3>Horizontal Scaling</h3>
            <p>For larger games, scale horizontally:</p>
            <ul>
                <li>Multiple Node.js instances behind load balancer (nginx/HAProxy)</li>
                <li>Shared MySQL database (or master-slave replication)</li>
                <li>Redis for session storage (optional)</li>
                <li>Message queue for inter-process communication (optional)</li>
            </ul>

            <div class="tip">
                <strong>üí° Scaling Tip:</strong> Use a load balancer with sticky sessions to maintain WebSocket connections to the same server instance.
            </div>
        </section>

        <section>
            <h2>Performance Characteristics</h2>

            <table>
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Performance</th>
                        <th>Notes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>API Response Time</td>
                        <td>&lt; 100ms</td>
                        <td>Database queries optimized with indexes</td>
                    </tr>
                    <tr>
                        <td>WebSocket Latency</td>
                        <td>&lt; 50ms</td>
                        <td>Direct socket connections, minimal overhead</td>
                    </tr>
                    <tr>
                        <td>Concurrent Connections</td>
                        <td>10,000+</td>
                        <td>Per single Node.js instance</td>
                    </tr>
                    <tr>
                        <td>Memory Usage</td>
                        <td>~50MB base</td>
                        <td>Scales with connected players</td>
                    </tr>
                    <tr>
                        <td>CPU Usage</td>
                        <td>Low</td>
                        <td>I/O bound, not CPU intensive</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section>
            <h2>Security Architecture</h2>

            <h3>Defense-in-Depth</h3>
            <div class="feature-box">
                <h4>Input Validation</h4>
                <p>All inputs validated using express-validator before processing. SQL injection, XSS, and CSRF attacks prevented.</p>
            </div>

            <div class="feature-box">
                <h4>Password Security</h4>
                <p>Passwords hashed with bcryptjs (salt rounds: 10) before storage. Plain passwords never stored or logged.</p>
            </div>

            <div class="feature-box">
                <h4>Token Security</h4>
                <p>JWT tokens signed with HS256. Refresh tokens hashed in database. Remember tokens stored securely (client-side Keychain/encryption).</p>
            </div>

            <div class="feature-box">
                <h4>Rate Limiting</h4>
                <p>express-rate-limit prevents brute force attacks. Different rates for account creation (3/hour) vs login (5/15min).</p>
            </div>

            <div class="feature-box">
                <h4>CORS Protection</h4>
                <p>CORS enabled for specified domains only. Prevents unauthorized cross-origin requests.</p>
            </div>
        </section>

        <section>
            <h2>Configuration & Environment</h2>

            <h3>Required Environment Variables</h3>
            <table>
                <thead>
                    <tr>
                        <th>Variable</th>
                        <th>Purpose</th>
                        <th>Example</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>SERVER_PORT</code></td>
                        <td>Server port</td>
                        <td>7777</td>
                    </tr>
                    <tr>
                        <td><code>NODE_ENV</code></td>
                        <td>Environment</td>
                        <td>production</td>
                    </tr>
                    <tr>
                        <td><code>DB_HOST</code></td>
                        <td>Database host</td>
                        <td>localhost</td>
                    </tr>
                    <tr>
                        <td><code>DB_USER</code></td>
                        <td>Database username</td>
                        <td>root</td>
                    </tr>
                    <tr>
                        <td><code>DB_PASSWORD</code></td>
                        <td>Database password</td>
                        <td>(encrypted)</td>
                    </tr>
                    <tr>
                        <td><code>DB_NAME</code></td>
                        <td>Database name</td>
                        <td>tidal_hunters</td>
                    </tr>
                    <tr>
                        <td><code>JWT_SECRET</code></td>
                        <td>JWT signing key</td>
                        <td>(long random string)</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section>
            <h2>Key Features Summary</h2>

            <div class="feature-grid">
                <div class="feature-box">
                    <h4>üîê Enterprise Security</h4>
                    <p>JWT authentication, bcrypt password hashing, rate limiting, input validation, and CORS protection built-in.</p>
                </div>

                <div class="feature-box">
                    <h4>‚ö° Real-Time Updates</h4>
                    <p>WebSocket support for instant friend status updates, game invites, and multiplayer coordination.</p>
                </div>

                <div class="feature-box">
                    <h4>üìä Scalable Design</h4>
                    <p>Horizontal scaling, stateless architecture, connection pooling, and optimized database queries.</p>
                </div>

                <div class="feature-box">
                    <h4>üë• Social Features</h4>
                    <p>Complete friend system, game invites, session management, and player-to-player communication.</p>
                </div>

                <div class="feature-box">
                    <h4>üéÆ Game-Focused</h4>
                    <p>Built specifically for multiplayer games with session management, invite expiration, and heartbeat tracking.</p>
                </div>

                <div class="feature-box">
                    <h4>üìö Well Documented</h4>
                    <p>Complete API reference, integration guides for all major engines, database schema, and deployment guides.</p>
                </div>
            </div>
        </section>

        <section>
            <h2>What's Included</h2>
            <ul>
                <li><strong>Complete Backend Server</strong> - Fully functional Node.js/Express application</li>
                <li><strong>Database Migrations</strong> - SQL scripts for setup and schema management</li>
                <li><strong>API Documentation</strong> - Full endpoint reference with examples</li>
                <li><strong>Integration Guides</strong> - Unity, Unreal, Swift, Kotlin, Flutter, React Native</li>
                <li><strong>Test Suite</strong> - Comprehensive test coverage</li>
                <li><strong>Example Projects</strong> - Working implementations in multiple engines</li>
                <li><strong>Deployment Tools</strong> - Docker configuration, deployment checklist</li>
                <li><strong>Security Audit</strong> - Third-party security review documentation</li>
            </ul>
        </section>

        <section>
            <h2>Getting Started</h2>
            <ol>
                <li><strong>Review Architecture</strong> - Understand system design and components</li>
                <li><strong>Setup Database</strong> - Run migrations, verify connection</li>
                <li><strong>Deploy Server</strong> - Install Node.js, npm install, start server</li>
                <li><strong>Test API</strong> - Use provided test client or Postman collection</li>
                <li><strong>Integrate Client</strong> - Choose your game engine guide (Unity/Unreal/Mobile)</li>
                <li><strong>Customize</strong> - Modify endpoints and features for your game</li>
                <li><strong>Deploy to Production</strong> - Use deployment guide for your hosting platform</li>
            </ol>

            <div class="tip">
                <strong>üí° Recommendation:</strong> Start with the Database & SQL documentation, then follow your engine's integration guide.
            </div>
        </section>
    </div>

    <footer>
        <p>&copy; 2026 FoxTooth Backend. System Architecture & Overview.</p>
        <p><a href="docs-hub.html">Documentation Hub</a> | <a href="index.html">Main Page</a></p>
    </footer>
</body>
</html>
